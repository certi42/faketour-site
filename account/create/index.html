<!DOCTYPE html>
<html>
<iframe width="0" height="0" border="0" name="dummyframe" id="dummyframe" style="display:none;"></iframe>
<head>
    <title>Create Account | Faketour</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="/menu/styles.css">
    <script type="text/javascript" src="/menu/loadMenu.js"></script>
</head>
<body>
<div class="content"></div>
<div class="topnav"></div>
<script type="text/javascript">loadMenu("Create Account");</script>
<h2 style="margin-left:10%; color:white;">Create New Account</h2>
<h2 style="color:red; text-align:center; background-color: rgba(51,51,51,50)">Warning: This site features negative encryption, so don't reuse a password from somewhere else</h2>
<form onsubmit="login(); return false;" target="dummyframe">
    <div class="imgcontainer">
        <img src="login_avatar.png" alt="Avatar" class="avatar">
    </div>
    <div class="container">
        <label for="uname"><b>Username</b></label>
        <input id="uname" type="text" placeholder="Enter Username" name="uname" required>
        <label for="psw"><b>Password</b></label>
        <input id="psw" type="password" placeholder="Enter Password" name="psw" required>
        <label for="psw"><b>Reenter Password</b></label>
        <input id="psw2" type="password" placeholder="Reenter Password" name="psw" required>
        <button type="submit">New Account</button>
    </div>
</form>

<div class="footer"><a href='https://twitter.com/velinovart'>Artwork by @velinovart</a></div>

<script>
    async function login() {
        let username = document.getElementById("uname").value;
        let password = document.getElementById("psw").value;
        let psw2 = document.getElementById("psw2").value;
        if(password != psw2) {
            showAlert("Error", "Passwords do not match", "error");
            return;
        } else if(password.length > 30) {
            showAlert("Error", "Password max length has been exceeded", "error");
            return;
        }
        let inputs = {username, password}
        let data = await fetch("newaccount.php", {
            method:'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: Object.keys(inputs).map(e => `${e}=${inputs[e]}`).join('&')
        });
        let success = null;
        try {
            success = await data.json();
        } catch {
            showAlert("Faield to create account", "Check the console for more informatino", "error");
        }
        console.log(success);
        
        if(success == true) {
            window.location.href = "/account/";
        } else {
            showAlert("Username already taken", "Please choose a unique username", "warning");
        }
    }
</script>

</body>
</html>
